<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìã Phi·∫øu Y√™u C·∫ßu</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 30px 15px; }
    .container { max-width: 700px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); overflow: hidden; }
    .header { background: linear-gradient(135deg, #11998e, #38ef7d); color: white; padding: 35px 40px; text-align: center; }
    .header h1 { font-size: 1.8rem; margin-bottom: 8px; }
    .header p { opacity: 0.9; font-size: 0.95rem; }
    .form-body { padding: 35px 40px; }
    .form-group { margin-bottom: 20px; }
    label { display: block; font-weight: 600; color: #444; margin-bottom: 6px; font-size: 0.9rem; }
    label .req { color: #e53e3e; }
    input[type="text"], input[type="email"], input[type="date"], input[type="number"],
    select, textarea {
      width: 100%; padding: 11px 14px; border: 2px solid #e2e8f0; border-radius: 8px;
      font-size: 0.95rem; transition: border-color 0.2s; color: #333; background: white;
      font-family: inherit;
    }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #11998e; box-shadow: 0 0 0 3px rgba(17,153,142,0.1); }
    textarea { resize: vertical; min-height: 90px; }
    .section { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; margin: 20px 0; }
    .section-title { font-weight: 700; color: #2d3748; margin-bottom: 15px; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
    .urgency-group { display: flex; gap: 10px; }
    .urgency-option { flex: 1; }
    .urgency-option input[type="radio"] { display: none; }
    .urgency-option label {
      display: block; text-align: center; padding: 10px 8px; border: 2px solid #e2e8f0;
      border-radius: 8px; cursor: pointer; transition: all 0.2s; font-weight: 600; font-size: 0.85rem;
    }
    .urgency-option input:checked + label { color: white; }
    .urgency-normal input:checked + label { background: #48bb78; border-color: #48bb78; }
    .urgency-priority input:checked + label { background: #ed8936; border-color: #ed8936; }
    .urgency-urgent input:checked + label { background: #e53e3e; border-color: #e53e3e; }
    .urgency-normal label:hover { border-color: #48bb78; color: #48bb78; }
    .urgency-priority label:hover { border-color: #ed8936; color: #ed8936; }
    .urgency-urgent label:hover { border-color: #e53e3e; color: #e53e3e; }
    .urgency-note { font-size: 0.78rem; color: #718096; margin-top: 6px; text-align: center; }
    .half-day-group { display: flex; gap: 12px; margin-top: 8px; }
    .half-day-option { display: flex; align-items: center; gap: 6px; cursor: pointer; }
    .half-day-option input { width: auto; }
    .days-display { background: #ebf8ff; border: 2px solid #bee3f8; border-radius: 8px; padding: 12px; text-align: center; margin-top: 8px; }
    .days-display .days-num { font-size: 1.8rem; font-weight: 700; color: #2b6cb0; }
    .days-display .days-label { font-size: 0.85rem; color: #4a5568; }
    .access-level { display: flex; flex-direction: column; gap: 8px; }
    .access-option { display: flex; align-items: flex-start; gap: 10px; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: border-color 0.2s; }
    .access-option:hover { border-color: #667eea; }
    .access-option input { margin-top: 2px; flex-shrink: 0; }
    .access-option.selected { border-color: #667eea; background: #ebf4ff; }
    .issue-type { display: flex; flex-direction: column; gap: 8px; }
    .issue-option { display: flex; align-items: center; gap: 10px; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: border-color 0.2s; }
    .issue-option:hover { border-color: #667eea; }
    .issue-option input { flex-shrink: 0; }
    .btn-submit {
      width: 100%; padding: 15px; background: linear-gradient(135deg, #11998e, #38ef7d);
      color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 700;
      cursor: pointer; transition: opacity 0.2s; margin-top: 10px; letter-spacing: 0.5px;
    }
    .btn-submit:hover { opacity: 0.9; }
    .btn-submit:active { transform: scale(0.99); }
    .hidden { display: none; }
    .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    @media (max-width: 480px) {
      .form-body { padding: 20px; }
      .row-2 { grid-template-columns: 1fr; }
      .urgency-group { flex-direction: column; }
    }
    .info-badge { display: inline-block; background: #e2e8f0; color: #4a5568; border-radius: 4px; padding: 2px 8px; font-size: 0.75rem; font-weight: 600; margin-left: 6px; }
    /* Submit states */
    .btn-submit:disabled { opacity: 0.7; cursor: not-allowed; }
    .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.4); border-top-color: white; border-radius: 50%; animation: spin 0.7s linear infinite; vertical-align: middle; margin-right: 8px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    /* Result screens */
    .result-screen { display: none; text-align: center; padding: 60px 40px; }
    .result-screen.show { display: block; }
    .result-icon { font-size: 4rem; margin-bottom: 20px; }
    .result-screen h2 { font-size: 1.5rem; margin-bottom: 12px; color: #2d3748; }
    .result-screen p { color: #718096; margin-bottom: 8px; }
    .result-id { display: inline-block; background: #ebf8ff; border: 2px solid #bee3f8; color: #2b6cb0; font-weight: 700; font-size: 1rem; padding: 10px 20px; border-radius: 8px; margin: 15px 0; letter-spacing: 1px; }
    .btn-back { margin-top: 20px; padding: 12px 30px; background: linear-gradient(135deg, #11998e, #38ef7d); color: white; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; }
    .result-error { color: #c53030; }
    .result-error .result-id { background: #fff5f5; border-color: #feb2b2; color: #c53030; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üìã Phi·∫øu Y√™u C·∫ßu</h1>
    <p>Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ g·ª≠i y√™u c·∫ßu</p>
  </div>

  <!-- ‚úÖ M√†n h√¨nh th√†nh c√¥ng -->
  <div class="result-screen" id="screen-success">
    <div class="result-icon">‚úÖ</div>
    <h2>G·ª≠i y√™u c·∫ßu th√†nh c√¥ng!</h2>
    <p>Y√™u c·∫ßu c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ti·∫øp nh·∫≠n.</p>
    <p>M√£ y√™u c·∫ßu c·ªßa b·∫°n:</p>
    <div class="result-id" id="success-req-id">‚Äî</div>
    <p style="margin-top:10px">K·∫øt qu·∫£ duy·ªát s·∫Ω ƒë∆∞·ª£c g·ª≠i qua email <strong id="success-email"></strong></p>
    <br>
    <button class="btn-back" onclick="resetForm()">üìã G·ª≠i y√™u c·∫ßu kh√°c</button>
  </div>

  <!-- ‚ùå M√†n h√¨nh l·ªói -->
  <div class="result-screen result-error" id="screen-error">
    <div class="result-icon">‚ùå</div>
    <h2>G·ª≠i th·∫•t b·∫°i</h2>
    <p>ƒê√£ x·∫£y ra l·ªói khi g·ª≠i y√™u c·∫ßu.</p>
    <div class="result-id" id="error-msg">Vui l√≤ng th·ª≠ l·∫°i sau.</div>
    <br>
    <button class="btn-back" onclick="showForm()">üîÑ Th·ª≠ l·∫°i</button>
  </div>

  <form class="form-body" id="requestForm">

    <!-- Lo·∫°i y√™u c·∫ßu -->
    <div class="form-group">
      <label>Lo·∫°i y√™u c·∫ßu <span class="req">*</span></label>
      <select name="request_type" id="requestType" required onchange="showSection()">
        <option value="">-- Ch·ªçn lo·∫°i y√™u c·∫ßu --</option>
        <option value="Ngh·ªâ ph√©p">üèñÔ∏è Ngh·ªâ ph√©p</option>
        <option value="C·∫•p quy·ªÅn">üîê C·∫•p quy·ªÅn</option>
        <option value="IT Support">üíª IT Support</option>
      </select>
    </div>

    <!-- Th√¥ng tin c∆° b·∫£n -->
    <div class="row-2">
      <div class="form-group">
        <label>H·ªç v√† t√™n <span class="req">*</span></label>
        <input type="text" name="employee_name" placeholder="Nguy·ªÖn VƒÉn A" required>
      </div>
      <div class="form-group">
        <label>Email <span class="req">*</span></label>
        <input type="email" name="employee_email" placeholder="email@company.com" required>
      </div>
    </div>

    <div class="form-group">
      <label>Ph√≤ng ban <span class="req">*</span></label>
      <input type="text" name="department" placeholder="V√≠ d·ª•: K·∫ø to√°n, K·ªπ thu·∫≠t, Kinh doanh..." required>
    </div>

    <div class="form-group">
      <label>Ti√™u ƒë·ªÅ <span class="req">*</span></label>
      <input type="text" name="title" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ y√™u c·∫ßu..." required>
    </div>

    <div class="form-group">
      <label>N·ªôi dung chi ti·∫øt <span class="req">*</span></label>
      <textarea name="description" placeholder="M√¥ t·∫£ chi ti·∫øt y√™u c·∫ßu c·ªßa b·∫°n..." required></textarea>
    </div>

    <!-- ƒê·ªô ∆∞u ti√™n -->
    <div class="form-group">
      <label>ƒê·ªô ∆∞u ti√™n <span class="req">*</span></label>
      <div class="urgency-group">
        <div class="urgency-option urgency-normal">
          <input type="radio" name="urgency" id="urgency_normal" value="B√¨nh th∆∞·ªùng" checked>
          <label for="urgency_normal">üü¢ B√¨nh th∆∞·ªùng</label>
        </div>
        <div class="urgency-option urgency-priority">
          <input type="radio" name="urgency" id="urgency_priority" value="∆Øu ti√™n">
          <label for="urgency_priority">üü† ∆Øu ti√™n</label>
        </div>
        <div class="urgency-option urgency-urgent">
          <input type="radio" name="urgency" id="urgency_urgent" value="Kh·∫©n c·∫•p">
          <label for="urgency_urgent">üî¥ Kh·∫©n c·∫•p</label>
        </div>
      </div>
      <div class="urgency-note" id="urgencyNote">‚è± X·ª≠ l√Ω trong v√≤ng 3 ng√†y l√†m vi·ªác (T2‚ÄìT7)</div>
    </div>

    <!-- ===== SECTION: NGH·ªà PH√âP ===== -->
    <div class="section hidden" id="section-leave">
      <div class="section-title">üìÖ Th√¥ng tin ngh·ªâ ph√©p</div>

      <div class="form-group">
        <label>Lo·∫°i ngh·ªâ ph√©p <span class="req">*</span></label>
        <select name="leave_type" id="leaveType">
          <option value="">-- Ch·ªçn lo·∫°i --</option>
          <option value="Ngh·ªâ ph√©p nƒÉm">Ngh·ªâ ph√©p nƒÉm</option>
          <option value="Ngh·ªâ b·ªánh">Ngh·ªâ b·ªánh</option>
          <option value="Ngh·ªâ ƒë·∫∑c bi·ªát">Ngh·ªâ ƒë·∫∑c bi·ªát</option>
          <option value="Ngh·ªâ kh√¥ng l∆∞∆°ng">Ngh·ªâ kh√¥ng l∆∞∆°ng</option>
          <option value="Ngh·ªâ b√π">Ngh·ªâ b√π</option>
          <option value="Kh√°c">Kh√°c</option>
        </select>
      </div>

      <div class="row-2">
        <div class="form-group">
          <label>Ng√†y b·∫Øt ƒë·∫ßu <span class="req">*</span></label>
          <input type="date" name="leave_start_date" id="leaveStartDate" onchange="calcLeaveDays()">
        </div>
        <div class="form-group">
          <label>Ng√†y k·∫øt th√∫c <span class="req">*</span></label>
          <input type="date" name="leave_end_date" id="leaveEndDate" onchange="calcLeaveDays()">
        </div>
      </div>

      <!-- Ngh·ªâ n·ª≠a ng√†y -->
      <div class="form-group">
        <label>T√πy ch·ªçn n·ª≠a ng√†y</label>
        <div class="half-day-group">
          <label class="half-day-option">
            <input type="checkbox" name="half_day_start" id="halfDayStart" onchange="calcLeaveDays()">
            <span>N·ª≠a ng√†y ƒë·∫ßu (ng√†y b·∫Øt ƒë·∫ßu)</span>
          </label>
          <label class="half-day-option">
            <input type="checkbox" name="half_day_end" id="halfDayEnd" onchange="calcLeaveDays()">
            <span>N·ª≠a ng√†y cu·ªëi (ng√†y k·∫øt th√∫c)</span>
          </label>
        </div>
      </div>

      <div class="days-display" id="daysDisplay" style="display:none">
        <div class="days-num" id="daysCount">0</div>
        <div class="days-label">ng√†y ngh·ªâ (ch·ªâ t√≠nh T2 ‚Äì T7)</div>
      </div>
      <input type="hidden" name="leave_days" id="leaveDays">
    </div>

    <!-- ===== SECTION: C·∫§P QUY·ªÄN ===== -->
    <div class="section hidden" id="section-access">
      <div class="section-title">üîê Th√¥ng tin c·∫•p quy·ªÅn</div>

      <div class="form-group">
        <label>Lo·∫°i quy·ªÅn truy c·∫≠p <span class="req">*</span></label>
        <select name="access_type">
          <option value="">-- Ch·ªçn lo·∫°i --</option>
          <option value="H·ªá th·ªëng n·ªôi b·ªô (ERP, CRM, HRM...)">H·ªá th·ªëng n·ªôi b·ªô (ERP, CRM, HRM...)</option>
          <option value="C∆° s·ªü d·ªØ li·ªáu (MySQL, PostgreSQL...)">C∆° s·ªü d·ªØ li·ªáu (MySQL, PostgreSQL...)</option>
          <option value="Server / VPS">Server / VPS</option>
          <option value="D·ªãch v·ª• ƒë√°m m√¢y (AWS, GCP, Azure...)">D·ªãch v·ª• ƒë√°m m√¢y (AWS, GCP, Azure...)</option>
          <option value="Email / Google Workspace">Email / Google Workspace</option>
          <option value="M·∫°ng / VPN">M·∫°ng / VPN</option>
          <option value="Kh√°c">Kh√°c</option>
        </select>
      </div>

      <div class="form-group">
        <label>T√™n h·ªá th·ªëng / d·ªãch v·ª• <span class="req">*</span></label>
        <input type="text" name="system_name" placeholder="V√≠ d·ª•: H·ªá th·ªëng CRM, Database production...">
      </div>

      <div class="form-group">
        <label>M·ª•c ƒë√≠ch s·ª≠ d·ª•ng <span class="req">*</span></label>
        <textarea name="access_purpose" placeholder="M√¥ t·∫£ l√Ω do c·∫ßn c·∫•p quy·ªÅn..."></textarea>
      </div>

      <div class="form-group">
        <label>M·ª©c ƒë·ªô quy·ªÅn <span class="req">*</span></label>
        <div class="access-level">
          <label class="access-option">
            <input type="radio" name="access_level" value="Ch·ªâ ƒë·ªçc">
            <div><strong>Ch·ªâ ƒë·ªçc</strong> ‚Äì Ch·ªâ xem, kh√¥ng ch·ªânh s·ª≠a</div>
          </label>
          <label class="access-option">
            <input type="radio" name="access_level" value="ƒê·ªçc/Ghi">
            <div><strong>ƒê·ªçc / Ghi</strong> ‚Äì Xem v√† ch·ªânh s·ª≠a d·ªØ li·ªáu</div>
          </label>
          <label class="access-option">
            <input type="radio" name="access_level" value="Qu·∫£n tr·ªã">
            <div><strong>Qu·∫£n tr·ªã</strong> ‚Äì To√†n quy·ªÅn qu·∫£n l√Ω</div>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>Th·ªùi h·∫°n c·∫•p quy·ªÅn</label>
        <select name="access_duration">
          <option value="Vƒ©nh vi·ªÖn">Vƒ©nh vi·ªÖn</option>
          <option value="1 th√°ng">1 th√°ng</option>
          <option value="3 th√°ng">3 th√°ng</option>
          <option value="6 th√°ng">6 th√°ng</option>
          <option value="1 nƒÉm">1 nƒÉm</option>
          <option value="T·∫°m th·ªùi (ghi r√µ m·ª•c ƒë√≠ch)">T·∫°m th·ªùi (ghi r√µ m·ª•c ƒë√≠ch)</option>
        </select>
      </div>
    </div>

    <!-- ===== SECTION: IT SUPPORT ===== -->
    <div class="section hidden" id="section-it">
      <div class="section-title">üíª Th√¥ng tin IT Support</div>

      <div class="form-group">
        <label>Danh m·ª•c <span class="req">*</span></label>
        <select name="it_category">
          <option value="">-- Ch·ªçn danh m·ª•c --</option>
          <option value="Ph·∫ßn c·ª©ng (PC, m√†n h√¨nh...)">Ph·∫ßn c·ª©ng (PC, m√†n h√¨nh...)</option>
          <option value="Ph·∫ßn m·ªÅm / B·∫£n quy·ªÅn">Ph·∫ßn m·ªÅm / B·∫£n quy·ªÅn</option>
          <option value="M·∫°ng / Internet">M·∫°ng / Internet</option>
          <option value="T√†i kho·∫£n / Email">T√†i kho·∫£n / Email</option>
          <option value="B·∫£o tr√¨ / S·ª≠a ch·ªØa">B·∫£o tr√¨ / S·ª≠a ch·ªØa</option>
          <option value="H·ªó tr·ª£ k·ªπ thu·∫≠t">H·ªó tr·ª£ k·ªπ thu·∫≠t</option>
          <option value="Kh√°c">Kh√°c</option>
        </select>
      </div>

      <div class="form-group">
        <label>Lo·∫°i v·∫•n ƒë·ªÅ</label>
        <div class="issue-type">
          <label class="issue-option">
            <input type="radio" name="it_issue_type" value="Y√™u c·∫ßu m·ªõi (mua s·∫Øm, c√†i ƒë·∫∑t m·ªõi...)">
            <span>üÜï Y√™u c·∫ßu m·ªõi (mua s·∫Øm, c√†i ƒë·∫∑t m·ªõi...)</span>
          </label>
          <label class="issue-option">
            <input type="radio" name="it_issue_type" value="S·ª± c·ªë / L·ªói">
            <span>üö® S·ª± c·ªë / L·ªói c·∫ßn x·ª≠ l√Ω</span>
          </label>
          <label class="issue-option">
            <input type="radio" name="it_issue_type" value="N√¢ng c·∫•p / C·∫£i ti·∫øn">
            <span>‚¨ÜÔ∏è N√¢ng c·∫•p / C·∫£i ti·∫øn</span>
          </label>
        </div>
      </div>

      <div class="row-2">
        <div class="form-group">
          <label>V·ªã tr√≠ / Ph√≤ng</label>
          <input type="text" name="it_location" placeholder="V√≠ d·ª•: T·∫ßng 3, Ph√≤ng 301...">
        </div>
        <div class="form-group">
          <label>S·ªë t√†i s·∫£n (n·∫øu c√≥)</label>
          <input type="text" name="it_asset_number" placeholder="V√≠ d·ª•: PC-2024-001">
        </div>
      </div>
    </div>

    <button type="submit" class="btn-submit">üì® G·ª≠i y√™u c·∫ßu</button>
  </form>
</div>

<script>
  // ============================================================
  // ‚öôÔ∏è C·∫§U H√åNH WEBHOOK ‚Äî thay YOUR_N8N_HOST b·∫±ng domain th·∫≠t
  // V√≠ d·ª•: https://n8n.yourcompany.com/webhook/form-request
  // ============================================================
  const WEBHOOK_URL = 'https://pgv-app.piatec.co.th/webhook-test/form-request';

  // Submit form qua fetch ‚Üí webhook n8n
  document.getElementById('requestForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const btn = form.querySelector('.btn-submit');

    // Validate section c·ª• th·ªÉ
    const reqType = document.getElementById('requestType').value;
    if (!reqType) {
      alert('Vui l√≤ng ch·ªçn lo·∫°i y√™u c·∫ßu.');
      return;
    }

    // Gom t·∫•t c·∫£ field v√†o object
    const data = {};
    const fd = new FormData(form);
    fd.forEach((val, key) => { data[key] = val; });

    // Loading state
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span>ƒêang g·ª≠i...';

    try {
      const res = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (res.ok) {
        // L·∫•y requestId t·ª´ response n·∫øu c√≥, ho·∫∑c t·∫°o t·∫°m
        let reqId = '';
        try {
          const json = await res.json();
          reqId = json.requestId || json.body?.requestId || '';
        } catch(_) {}

        // Hi·ªán m√†n h√¨nh th√†nh c√¥ng
        document.getElementById('success-req-id').textContent = reqId || '(xem email ƒë·ªÉ bi·∫øt m√£)';
        document.getElementById('success-email').textContent = data.employee_email || '';
        document.getElementById('requestForm').style.display = 'none';
        document.getElementById('screen-success').classList.add('show');
      } else {
        const errText = await res.text().catch(() => `HTTP ${res.status}`);
        showError(errText || `L·ªói HTTP ${res.status}`);
      }
    } catch (err) {
      showError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Ki·ªÉm tra l·∫°i WEBHOOK_URL.');
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'üì® G·ª≠i y√™u c·∫ßu';
    }
  });

  function showError(msg) {
    document.getElementById('error-msg').textContent = msg;
    document.getElementById('requestForm').style.display = 'none';
    document.getElementById('screen-error').classList.add('show');
  }

  function showForm() {
    document.getElementById('screen-error').classList.remove('show');
    document.getElementById('requestForm').style.display = 'block';
  }

  function resetForm() {
    document.getElementById('screen-success').classList.remove('show');
    document.getElementById('requestForm').reset();
    document.getElementById('requestForm').style.display = 'block';
    showSection();
  }

  // Set tomorrow as min date for leave
  function setMinDate() {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const minDate = tomorrow.toISOString().split('T')[0];
    document.getElementById('leaveStartDate').min = minDate;
    document.getElementById('leaveEndDate').min = minDate;
  }
  setMinDate();

  // Show/hide section based on request type
  function showSection() {
    const val = document.getElementById('requestType').value;
    document.getElementById('section-leave').classList.add('hidden');
    document.getElementById('section-access').classList.add('hidden');
    document.getElementById('section-it').classList.add('hidden');
    if (val === 'Ngh·ªâ ph√©p') document.getElementById('section-leave').classList.remove('hidden');
    else if (val === 'C·∫•p quy·ªÅn') document.getElementById('section-access').classList.remove('hidden');
    else if (val === 'IT Support') document.getElementById('section-it').classList.remove('hidden');
  }

  // Urgency note
  document.querySelectorAll('input[name="urgency"]').forEach(radio => {
    radio.addEventListener('change', () => {
      const notes = {
        'B√¨nh th∆∞·ªùng': '‚è± X·ª≠ l√Ω trong v√≤ng 3 ng√†y l√†m vi·ªác (T2‚ÄìT7)',
        '∆Øu ti√™n': '‚ö° X·ª≠ l√Ω trong v√≤ng 2 ng√†y l√†m vi·ªác (T2‚ÄìT7)',
        'Kh·∫©n c·∫•p': 'üö® X·ª≠ l√Ω trong v√≤ng 1 ng√†y l√†m vi·ªác (T2‚ÄìT7)'
      };
      document.getElementById('urgencyNote').textContent = notes[radio.value] || '';
    });
  });

  // Calculate leave days (Mon-Sat only, no Sunday)
  function calcLeaveDays() {
    const startVal = document.getElementById('leaveStartDate').value;
    const endVal = document.getElementById('leaveEndDate').value;

    // Sync end date min to start date
    if (startVal) {
      document.getElementById('leaveEndDate').min = startVal;
    }

    if (!startVal || !endVal) {
      document.getElementById('daysDisplay').style.display = 'none';
      return;
    }

    const start = new Date(startVal + 'T00:00:00');
    const end = new Date(endVal + 'T00:00:00');

    if (end < start) {
      document.getElementById('leaveEndDate').value = startVal;
      calcLeaveDays();
      return;
    }

    // Count Mon-Sat (no Sunday)
    let days = 0;
    let cur = new Date(start);
    while (cur <= end) {
      const dow = cur.getDay(); // 0=Sun
      if (dow !== 0) days++;
      cur.setDate(cur.getDate() + 1);
    }

    // Half day deductions
    const halfStart = document.getElementById('halfDayStart').checked;
    const halfEnd = document.getElementById('halfDayEnd').checked;

    // Check if start or end is sunday (skip deduction for that)
    const startDow = start.getDay();
    const endDow = end.getDay();

    let halfDeduction = 0;
    if (halfStart && startDow !== 0) halfDeduction += 0.5;
    if (halfEnd && endDow !== 0) halfDeduction += 0.5;

    // If same day and both half-days checked
    if (startVal === endVal && halfStart && halfEnd && startDow !== 0) {
      halfDeduction = 0.5; // still counts as 0.5 day
    }

    const total = Math.max(0, days - halfDeduction);

    document.getElementById('daysCount').textContent = total % 1 === 0 ? total : total.toFixed(1);
    document.getElementById('leaveDays').value = total;
    document.getElementById('daysDisplay').style.display = 'block';
  }
</script>
</body>
</html>



